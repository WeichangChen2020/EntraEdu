<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<include file="./Public/weui2.0/__head.html"/>
		<link href="__PUBLIC__/css/exercise.css" type="text/css" rel="stylesheet"/>
		<link rel="stylesheet" href="__PUBLIC__/css/style.css">
        <link rel="stylesheet" href="__PUBLIC__/css/pages.css">
		<script src="__PUBLIC__/font/iconfont.js"></script>
		<style type="text/css">
			.bar {padding: 0; padding: 0 20px; background-color:#fbf9fe; color: #476777; }
			.title {background-color:#fbf9fe; color: #476777;}
            .bar .icon {margin: 10px 0; padding: 0; }
            .weui-dialog__btn {color: #4bc2ff;}
            /*.icon {width: 20px; height: 20px}*/
            .weui-badge{background-color: #00ff00;}
		</style>
	</head>
	<body>
            <div class="weui-msg">
            <div class="weui-msg__icon-area">
                <img class="img" src="{$stuInfo['headimgurl']|default='__PUBLIC__/images/newer/xsc_logo.jpg'}">
            </div>
            <div class="weui-msg__text-area">
                <h2 class="weui-msg__title">{$stuInfo['name']}</h2>
                <div class="weui-cells__title">考试说明</div>
                <div class="weui-form-preview">
                    <div class="weui-form-preview__bd">
                        <div class="weui-form-preview__item">
                            <ul>
                                <li>1. 本次考试时间：{$examInfo.start_time|date="H:i",###} -- <php> echo date("H:i", $examInfo['start_time'] + $examInfo['set_time']*60);</php></li>
                                <li>2. 本次考试题目<span>{$examInfo['count']}</span>道题</li>
                                <li>3. 答对<span>{$examInfo['count']*4/5|ceil}</span>道题目算通过</li>
                                <li>4. 一人只有<span>一次</span>提交机会</li>
                                <li>5. 点击<span>进入考试</span>后开始计时，时间结束还未答完的将<span>自动提交</span>试卷</li>
                                <li>6. 答题界面的右上角按钮为<span>索引</span>，可跳至<span>任意</span>题目</li>
                            </ul>    
                        </div>
                    </div>
                  
                  
                </div>
            </div>
            <div class="weui-msg__opr-area">
                <p class="weui-btn-area">
                    <a id="enter_exam" class="weui-btn weui-btn_primary">进入考试</a>
            </div>
            
        </div>
				
			<a class="c-button" id="submit"}">提交</a>

		</div>

		<div class='demos-content-padded'></div>

		<div id="half" class='weui-popup__container popup-bottom'>
		    <div class="weui-popup__overlay"></div>
		    <div class="weui-popup__modal">
		        <div class="toolbar">
			        <div class="toolbar-inner" >
				       <div class="helf-title">模拟考试</div>				       
				    </div>
		            
		        </div>
		        <div class="modal-content" style="height: auto; max-height: 400px; color: #000;">
		        	<volist name="quesList" id="quesList" key="k" >
		        		<if condition="($k)%7 eq 1">
		        			<div class="weui-flex">
							    <a class="weui-flex__item" href="{:U('Exam/exam',array('selectid'=>$quesList['id']))}"><div class="{$quesList.result|get_exam_index_css=###}">{$k}</div></a>
						<elseif condition="($k)%7 eq 0"/>
							<a class="weui-flex__item" href="{:U('Exam/exam',array('selectid'=>$quesList['id']))}"><div class="{$quesList.result|get_exam_index_css=###}">{$k}</div></a>
							    </div>
						<else /> 
							<a class="weui-flex__item" href="{:U('Exam/exam',array('selectid'=>$quesList['id']))}"><div class="{$quesList.result|get_exam_index_css=###}">{$k}</div></a>
						</if>
					</volist>
				   

		        </div>
		    </div>
		</div>
	</body>
</html>

<include file="./Public/weui2.0/__foot.html"/>
<script type="text/javascript" src="__PUBLIC__/js/countdown.js"></script>
<script type="text/javascript">
	$(document).ready(function(){

		// 初始化 ABCD四个选项的点击次数 和 索引关系
	    var click_times = {'对':0, '错':0};
	    var click_index = {'对':2, '错':3};

	     // 定时
	    function time(){
	    	countdown({$end_time});
	    }
		setInterval(time,1000);
	   

		// 初始化如果用户已经选择了答案
		if ("{$examItem.result}" != '-1') {
			var option = "{$examItem.answer}";
			if (option!='') {
				var selected_option = $('use')[click_index[option]];
				var selected_option_attr = selected_option.getAttribute('xlink:href');
				selected_option.setAttribute('xlink:href', '#icon-danxuan');	
			}
		} 

	    // 点击选项后上传答案
		$('.option-area').click(function(){
			// 选择了之后
			var use       = $(this).find('use')[0];
			var lable      = $(this).find('lable')[0];
			var option     = lable.innerHTML == '正确' ? '对' : '错'; //选项
			click_times[option] ++;

			
			var data = {
				'selectid': "{$examItem['id']}" , 
				'option': option,
			}

			var url = "{:U('Exam/submit')}";
	        $.post(url, data, function(res){
	            returnInfo(res);
	        });

	        // 判断该选项是否选中,并消除其他选项的样式
			for (var i = 0; i < $('.content').find('use').length; i++)
			{
				$('.content').find('use')[i].setAttribute('xlink:href', '#icon-icondanxuanxiangweixuanze');				
			}
			use.setAttribute('xlink:href', '#icon-danxuan');

			// console.log(option);		
		})


		// 点击后monup
		$(document).on("click", ".weui-popup-modal", function() {
	        console.log("open popup");
	    }).on("close", ".weui-popup-modal", function() {
	        console.log("close popup");
	    });

	    // 点击提交按钮
	    $('#submit').click(function(){

	    	$.confirm("只有一次提交机会，你确定要提交吗?", "确认提交?", function() {
	    		window.location.href="{:U('Exam/tip')}";
	        }, function() {
	          //取消操作
	        });
	    });


	});

	

	// 离开考试页面
    function leave_exam() {
    	$.confirm("您确定要中途离开本次考试嘛?", "确认离开?", function() {
    		window.location.href="{:U('Exam/listExam')}";
        }, function() {
          //取消操作
        });
    };
</script>
